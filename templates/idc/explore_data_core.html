{% load custom_tags %}
{% load static %}
<div class="container-fluid">
    <div class="row">
        <div class="tab-content data-tab-content">
            <input id="number_ajax" type="hidden" value="0">
            <div class="spinner" style="display: none;"><i class="fa-solid fa-spinner fa-spin spin"></i></div>
            <div id="lh_panel" class="tab-pane data-tab active flex_div" role="tabpanel">
                <div class="col-lg-3 col-md-3 main_cols">
                    <div class="filter-panel panel data-tab-content-panel lh">
                        <a data-toggle="collapse" aria-label="hideit" onclick="hidePanel()"><i
                                class="show fa fa-angle-double-left"></i></a>
                    </div>
                    {% if is_cohort %}
                        <div class="data-version panel data-tab-content-panel">
                            <div class="tab-panel panel-default">
                                <div class="panel-heading clearfix">
                                    <h4 class="panel-title">{{ cohort_version }}</h4>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    <div class="search-scope filter-panel panel data-tab-content-panel">
                        <div class="tab-panel panel-default">
                            <div class="panel-heading clearfix">
                                <h4 class="panel-title">Search Scope</h4>
                            </div>
                            <div class="tab-content">
                                <div id="access_set" class="tab-pane active" role="tabpanel">
                                    {% with set_attributes.origin_set.All.attributes|get_by_name:'access' as attr %}
                                   <ul class="list-group" role="tablist" aria-multiselectable="true">
                                                <li class="list-group-item">
                                                    <div id="{{ attr.name }}_heading" class="list-group-item__heading">
                                                        <a role="button" data-toggle="collapse" href="#{{ attr.name }}"
                                                           aria-expanded="false" aria-controls="{{ attr.name }}">
                                                            <i class="fa fa-solid fa-caret-right"></i> <i
                                                                class="fa fa-solid fa-caret-down"></i> <span
                                                                class="attDisp">Access
                                                            {% if attr.units %}({{ attr.units }}){% endif %}</span>
                                                            <span class="notDisp noCase"> (0 cases)</span>
                                                        </a>

                                                    </div>

                                                    <div id="{{ attr.name }}" data-filter-attr-id="{{ attr.id }}"
                                                         class="collapse list-group-item__body">


                                                        <ul id="{{ attr.name }}_list" class="search-checkbox-list"
                                                            style="list-style: none;">
                                                            {% for val in attr.values|check_for_order:attr.name %}
                                                                {% with val.display_value|get_display_val:val.value as display_value %}
                                                                    <li class="checkbox{% if attr.values|length > 1 and forloop.counter >= 6 %} extra-values notDisp{% endif %} {% if val.count == 0 %} zeroed {% endif %}">
                                                                        <label>
                                                                            <input type="checkbox"
                                                                                   value="{{ val.value }}"
                                                                                   data-filter-attr-id="{{ attr.id }}"
                                                                                   data-filter-display-attr="{{ attr.display_name }}"
                                                                                   data-filter-display-val="{{ display_value }}">
                                                                            <span class="value">{{ display_value }}</span>
                                                                            <span class="float-right plot_count count plotit">{{ val.count }}</span>
                                                                            <span class="float-right case_count count">{{ val.count }}</span>
                                                                        </label>
                                                                    </li>
                                                                {% endwith %}
                                                            {% endfor %}
                                                        </ul>

                                                    </div>
                                                </li>
                                            </ul>
                                {% endwith %}
                                </div>
                                <div id="program_set" class="tab-pane active" role="tabpanel">
                                    <ul class="list-group" role="tablist" aria-multiselectable="true">
                                        <li class="list-group-item">
                                            <div id="Program_heading" class="list-group-item__heading">
                                                <a role="button" data-toggle="collapse" href="#Program"
                                                   aria-expanded="true" aria-controls="Program">
                                                    <i class="fa fa-solid fa-caret-right"></i> <i
                                                        class="fa fa-solid fa-caret-down"></i>Collection
                                                </a>
                                                <span class="controls">
                                             <i class="fa-solid fa-circle-minus coll-explain"></i>
                                             <i class="fa-solid fa-cog" title="Settings"></i>
                                             <i class="fa-solid fa-search" title="Filter values"></i>
                                         </span>
                                            </div>
                                            <div id="Program" data-filter-attr-nm="Program"
                                                 class="filter-panel collection-list collapse in" aria-expanded="true">
                                                <input id="collection_search"
                                                       class="collection-text-filter notDisp value-search" type="text"
                                                       placeholder="Search..." onkeyup="updateColl(true)">
                                                <div class="sorter cntr notDisp">
                                                    <span>Sort by: <input type="radio" class="sort_val" value="alpha"
                                                                          name="Program" checked onclick="updateColl()">Alpha<input
                                                            type="radio" class="sort_val" value="num" name="Program"
                                                            onclick="updateColl()">Num</span>

                                                </div>
                                                <div style="display:block">
                                                <input id="hide-zeros" class="hide-zeros "  type="checkbox"
                                                       value="hide-zeros" onchange="updateColl()"> Hide collections with 0 cases
                                                </div>

                                                {% with programs.items|length|add:"-5" as more %}
                                                    <p class="more-checks" style="display: block;"><a class="show-more">show {{ more }}
                                                        more</a><span class="checks"><a class="check-all">Check All</a> / <a
                                                            class="uncheck-all">Uncheck All</a></span></p>
                                                    <p class="less-checks" style="display: none;"><a class="show-less">show
                                                        less</a><span class="checks"><a class="check-all">Check All</a> / <a
                                                            class="uncheck-all">Uncheck All</a></span></p>
                                                {% endwith %}
                                                <ul id="Program_list" class="search-checkbox-list"
                                                    style="list-style: none;">
                                                    {% for progK, progV in programs.items|dictsort:0 %}
                                                        {% if progK != "All" and progK != "None" %}
                                                            <li class="list-group-item  {% if forloop.counter >= 6 %} extra-values notDisp{% endif %} {% if progV.val == 0 %} zeroed {% endif %}">
                                                                {% if progV.projects and progV.projects.items|length == 1 %}
                                                                    {% for proj, projD in progV.projects.items %}
                                                                        <div id="{{ proj }}_heading"
                                                                             class="list-group-item__heading">
                                                                            <input data-filter-attr-id="{{ progV.collex_attr_id }}"
                                                                                   data-filter-display-attr="Collection"
                                                                                   data-filter-display-val="{{ proj|upper }}"
                                                                                   class="collection_value"
                                                                                   type="checkbox" value="{{ proj }}">
                                                                            {% if projD.access == "Public" %}
                                                                                <span id="{{ proj }}"
                                                                                      class="collection_name value collection_id">{{ projD.display }} </span>
                                                                                <span class="float-right case_count count">{{ projD.val }}</span>
                                                                            {% else %}
                                                                                <span id="{{ proj }}"
                                                                                      class="collection_name value collection_id">{{ projD.display }}<i
                                                                                        class="fa-solid fa-circle-minus"></i></span>
                                                                                <span class="float-right case_count count">{{ projD.val }}</span>
                                                                            {% endif %}
                                                                        </div>
                                                                    {% endfor %}
                                                                {% elif progV.projects and progV.projects.items|length > 1 %}

                                                                    <div id="{{ progK }}_heading"
                                                                         class="list-group-item__heading">
                                                                        <input data-filter-attr-id="{{ progV.prog_attr_id }}"
                                                                               data-filter-display-attr="Program"
                                                                               data-filter-display-val="{{ progK|upper }}"
                                                                               type="checkbox" value="{{ progK }}">
                                                                        <a role="button" data-toggle="collapse"
                                                                           href="#{{ progK }}" aria-expanded="false"
                                                                           aria-controls="{{ progK }}">
                                                                            <i class="fa fa-solid fa-caret-right"></i>
                                                                            <i class="fa fa-solid fa-caret-down"></i>
                                                                        </a>
                                                                        <span class="value">
                                                             {{ progK|upper }}
                                                         </span>
                                                                        <span class="float-right case_count count">{{ progV.val }}</span>
                                                                    </div>
                                                                    <div id="{{ progK }}"
                                                                         data-filter-attr-id="{{ progV.collex_attr_id }}"
                                                                         class="collapse list-group-sub-item__body">
                                                                        {% if progV.projects.items|length > 5 %}
                                                                            {% with progV.projects.items|length|add:"-5" as more %}
                                                                                <p class="more-checks"><a
                                                                                        class="show-more">show {{ more }}
                                                                                    more</a><span class="checks"><a
                                                                                        class="check-all">Check All</a> / <a
                                                                                        class="uncheck-all">Uncheck All</a></span>
                                                                                </p>
                                                                                <p class="less-checks notDisp"><a
                                                                                        class="show-less">show
                                                                                    less</a><span class="checks"><a
                                                                                        class="check-all">Check All</a> / <a
                                                                                        class="uncheck-all">Uncheck All</a></span>
                                                                                </p>
                                                                            {% endwith %}
                                                                        {% else %}
                                                                            <p class="check-uncheck"><span
                                                                                    class="checks2"><a
                                                                                    class="check-all">Check All</a> / <a
                                                                                    class="uncheck-all">Uncheck All</a></span>
                                                                            </p>
                                                                        {% endif %}
                                                                        <ul id="{{ progK }}_proj_list"
                                                                            class="search-checkbox-list"
                                                                            style="list-style: none;">
                                                                            {% for proj, projD in progV.projects.items|dictsort:0 %}
                                                                                <li class="checkbox {% if forloop.counter >= 6 %} extra-values notDisp{% endif %} {% if projD.val == 0 %} zeroed {% endif %}">
                                                                                    <label>
                                                                                        <input data-filter-attr-id="{{ progV.collex_attr_id }}"
                                                                                               data-filter-display-attr="Collection"
                                                                                               data-filter-display-val="{{ proj|upper }}"
                                                                                               class="collection_value"
                                                                                               type="checkbox"
                                                                                               value="{{ proj }}">
                                                                                        {% if projD.access == 'Public' %}
                                                                                            <span id="{{ proj }}"
                                                                                                  class="collection_name value">{{ projD.display }} </span>
                                                                                            <span class="float-right case_count count plotit">{{ projD.val }}</span>
                                                                                        {% else %}
                                                                                            <span id="{{ proj }}"
                                                                                                  class="collection_name value">{{ projD.display }} <i
                                                                                                    class="fa-solid fa-circle-minus"></i></span>
                                                                                            <span class="float-right case_count count plotit">{{ projD.val }}</span>
                                                                                        {% endif %}
                                                                                    </label>
                                                                                </li>
                                                                            {% endfor %}
                                                                        </ul>
                                                                    </div>
                                                                {% endif %}
                                                            </li>
                                                        {% endif %}
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                                <div id="analysis_set" class="tab-pane active" role="tabpanel">
                                    {% with set_attributes.origin_set.All.attributes|get_by_name:'analysis_results_id' as attr %}
                                   <ul class="list-group" role="tablist" aria-multiselectable="true">
                                                <li class="list-group-item">
                                                    <div id="{{ attr.name }}_heading" class="list-group-item__heading">
                                                        <a role="button" data-toggle="collapse" href="#{{ attr.name }}"
                                                           aria-expanded="false" aria-controls="{{ attr.name }}">
                                                            <i class="fa fa-solid fa-caret-right"></i> <i
                                                                class="fa fa-solid fa-caret-down"></i> <span
                                                                class="attDisp">Analysis Results
                                                            {% if attr.units %}({{ attr.units }}){% endif %}</span>
                                                            <span class="notDisp noCase"> (0 cases)</span>
                                                        </a>

                                                    <span class="controls">
                                                   <i class="fa-solid fa-cog" title="Settings"></i>
                                                   <i class="fa-solid fa-search" title="Filter values"></i>
                                                  </span>

                                                    </div>

                                                    <div id="{{ attr.name }}" data-filter-attr-id="{{ attr.id }}"
                                                         class="collapse list-group-item__body">

                                                    <input id="analysis_search"
                                                       class="text-filter notDisp value-search" type="text"
                                                       placeholder="Search..." onkeyup="updateFilters('analysis_results_id',{},false,true)">

                                                     <div class="sorter cntr notDisp">
                                                         <span>Sort by: <input type="radio" class="sort_val" value="alpha"
                                                                          name="Access" checked onclick="resort('analysis_results_id')">Alpha<input
                                                            type="radio" class="sort_val" value="num" name="Access"
                                                            onclick="resort('analysis_results_id')">Num</span>

                                                     </div>

                                                    <div style="display:block">
                                                    <input id="hide-zeros" class="hide-zeros" type="checkbox"
                                                       value="hide-zeros" onchange="updateFilters('analysis_results_id',{},false,false)"> Hide analysis results with 0 cases
                                                    </div>

                                                {% with attr.values|length|add:"-5" as more %}
                                                    <p class="more-checks" style="display: block;"><a class="show-more">show {{ more }}
                                                        more</a><span class="checks"><a class="check-all">Check All</a> / <a
                                                            class="uncheck-all">Uncheck All</a></span></p>
                                                    <p class="less-checks" style="display: none;"><a class="show-less">show
                                                        less</a><span class="checks"><a class="check-all">Check All</a> / <a
                                                            class="uncheck-all">Uncheck All</a></span></p>
                                                {% endwith %}


                                                        <ul id="{{ attr.name }}_list" class="search-checkbox-list"
                                                            style="list-style: none;">
                                                            {% for val in attr.values|check_for_order:attr.name %}
                                                                {% with val.display_value|get_display_val:val.value as display_value %}
                                                                    <li class="checkbox{% if attr.values|length > 1 and forloop.counter >= 6 %} extra-values notDisp{% endif %} {% if val.count == 0 %} zeroed {% endif %}">
                                                                        <label>
                                                                            <input type="checkbox"
                                                                                   value="{{ val.value }}"
                                                                                   data-filter-attr-id="{{ attr.id }}"
                                                                                   data-filter-display-attr="{{ attr.display_name }}"
                                                                                   data-filter-display-val="{{ display_value }}">
                                                                            <span class="value">{{ display_value }}</span>
                                                                            <span class="float-right plot_count count plotit">{{ val.count }}</span>
                                                                            <span class="float-right case_count count">{{ val.count }}</span>
                                                                        </label>
                                                                    </li>
                                                                {% endwith %}
                                                            {% endfor %}
                                                        </ul>

                                                    </div>
                                                </li>
                                            </ul>
                                {% endwith %}
                                </div>
                            </div>
                        </div>
                    </div>

                    {% if DEV_TIER %}
                        <div class="tabpanel data-tab-content-panel" style="display:none">
                            <div class="panel panel-default">
                                <div class="panel-heading clearfix"><h4 class="panel-title">Data Source</h4></div>
                                <div class="panel-body">
                                    <select id="data_source_type">
                                        <option selected value="S"> Solr (Lucene)</option>
                                        <option value="B"> BigQuery</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    <div id="search-configuration" class="search-configuration filter-panel search-con" role="tabpanel">
                        <div class="tabpanel panel-default" role="tabpanel">
                            <div class="panel-heading clearfix">
                                <h4 class="panel-title">Search Configuration
                                </h4>
                                <br><span><input id="hide-zeros" class="hide-zeros" type="checkbox" value="hide-zeros"
                                                 onchange="hideAtt(this)"> Hide attribute values with 0 cases</span>
                            </div>

                            <ul class="nav nav-tabs nav-tabs-filters" role="tablist">
                                <li id="search_orig" role="presentation" class="filter-tab active"><a
                                        href="#search_orig_set" role="tab" data-toggle="tab" title="orig"
                                        aria-expanded="true">Original</a></li>
                                {% if set_attributes.derived_set is None %}
                                    <li id="search_derived" role="presentation" class="filter-tab disabled"><a
                                            href="#search_derived_set" role="tab" data-toggle="tab" title="derived"
                                            aria-expanded="false">Derived</a></li>
                                {% else %}
                                    <li id="search_derived" role="presentation" class="filter-tab"><a
                                            href="#search_derived_set" role="tab" data-toggle="tab" title="derived"
                                            aria-expanded="false">Derived</a></li>

                                {% endif %}

                                {% if set_attributes.related_set is None %}
                                    <li id="search_related" role="presentation" class="filter-tab disabled"><a
                                            href="#search_related_set" role="tab" data-toggle="tab" title="related"
                                            aria-expanded="false">Related</a></li>
                                {% else %}
                                    <li id="search_related" role="presentation" class="filter-tab"><a
                                            href="#search_related_set" role="tab" data-toggle="tab" title="related"
                                            aria-expanded="false">Related</a></li>

                                {% endif %}
                            </ul>
                            <div class="tab-content">
                                <div id="search_orig_set" role="tabpanel" class="tab-pane search-set active">
                                    {% for attr in set_attributes.origin_set.All.attributes|sort_orig_attr   %}
                                        {% if attr.name != "access" and attr.name != "collection_id"  and attr.name != "analysis_results_id" %}
                                            <ul class="list-group" role="tablist" aria-multiselectable="true">
                                                <li class="list-group-item">
                                                    <div id="{{ attr.name }}_heading" class="list-group-item__heading">
                                                        <a role="button" data-toggle="collapse" href="#{{ attr.name }}"
                                                           aria-expanded="false" aria-controls="{{ attr.name }}">
                                                            <i class="fa fa-solid fa-caret-right"></i> <i
                                                                class="fa fa-solid fa-caret-down"></i> <span
                                                                class="attDisp">{{ attr.display_name }}
                                                            {% if attr.units %}({{ attr.units }}){% endif %}</span>
                                                            <span class="notDisp noCase"> (0 cases)</span>
                                                        </a>
                                                        <span class="controls">
                                                     <i class="fa-solid fa-cog" title="Sort results"></i>
                                                     <i class="fa-solid fa-search" title="Filter displayed values"></i>
                                                 </span>
                                                    </div>

                                                    <div id="{{ attr.name }}" data-filter-attr-id="{{ attr.id }}"
                                                         class="list-group-item__body collapse
                                                            {% if attr.name in "Modality,BodyPartExamined,tcia_tumorLocation" %} in
                                                            {% endif %}"
                                                         aria-expanded="{% if attr.name in "Modality,BodyPartExamined,tcia_tumorLocation" %}true
                                                         {% else %}false{% endif %}"
                                                        {% if attr.min_max %}
                                                         data-min="{{ attr.min_max.min|floor }}"
                                                         data-max="{{ attr.min_max.max|ceiling }}"
                                                         data-curmin="{{ attr.min_max.min }}"
                                                         data-curmax="{{ attr.min_max.max }}"
                                                         data-curminrng="{{ attr.min_max.min|floor }}"
                                                         data-curmaxrng="{{ attr.min_max.max|ceiling }}"

                                                            {% endif %}>
                                                        <input class="text-filter value-search notDisp" type="text"
                                                               placeholder="Search..."
                                                               onkeyup="updateFilters( '{{ attr.name }}',{},false, true)">
                                                        {% if attr.name == "Modality" %}
                                                                Find studies with
                                                                    <input id="{{ attr.name }}_join_or" type="radio"
                                                                           class="join_val" name="{{ attr.name }}_join"
                                                                           value="OR" checked>
                                                                    <label for="{{ attr.name }}_join_or" class="join">ANY</label>
                                                                    <input id="{{ attr.name }}_join_and" type="radio"
                                                                           class="join_val" name="{{ attr.name }}_join"
                                                                        value="AND">
                                                                    <label for="{{ attr.name }}_join_and" class="join">ALL</label>
                                                                selected modalities
                                                            {% endif %}

                                                        <div class="sorter cntr notDisp">

                                                            Sort by: <input type="radio" class="sort_val"
                                                                            name="{{ attr.name }}" value="alpha" checked
                                                                            onclick="resort('{{ attr.name }}')">Alpha
                                                            <input type="radio" class="sort_val" name="{{ attr.name }}"
                                                                   value="num" onclick="resort('{{ attr.name }}')">Num
                                                        </div>
                                                        {% if attr.values|length > 5 %}
                                                            {% with attr.values|length|add:"-5" as more %}
                                                                <p class="more-checks" style="display: block;"><a
                                                                        class="show-more">show {{ more }} more</a><span
                                                                        class="checks"><a
                                                                        class="check-all">Check All</a> / <a
                                                                        class="uncheck-all">Uncheck All</a></span></p>
                                                                <p class="less-checks" style="display: none;"><a
                                                                        class="show-less">show less</a><span
                                                                        class="checks"><a
                                                                        class="check-all">Check All</a> / <a
                                                                        class="uncheck-all">Uncheck All</a></span></p>
                                                            {% endwith %}

                                                        {% else %}
                                                            <p class="check-uncheck"><span class="checks2"><a
                                                                    class="check-all">Check All</a> / <a
                                                                    class="uncheck-all">Uncheck All</a></span></p>
                                                        {% endif %}
                                                        <ul id="{{ attr.name }}_list" class="search-checkbox-list"
                                                            style="list-style: none;">
                                                            {% for val in attr.values|check_for_order:attr.name %}
                                                                {% with val.display_value|get_display_val:val.value as display_value %}
                                                                    <li class="checkbox{% if attr.values|length > 1 and forloop.counter >= 6 %} extra-values notDisp{% endif %} {% if val.count == 0 %} zeroed {% endif %}">
                                                                        <label>
                                                                            <input type="checkbox"
                                                                                   value="{{ val.value }}"
                                                                                   data-filter-attr-id="{{ attr.id }}"
                                                                                   data-filter-display-attr="{{ attr.display_name }}"
                                                                                   data-filter-display-val="{{ display_value }}">
                                                                            <span class="value">{{ display_value }}</span>
                                                                            <span class="float-right plot_count count plotit">{{ val.count }}</span>
                                                                            <span class="float-right case_count count">{{ val.count }}</span>
                                                                        </label>
                                                                    </li>
                                                                {% endwith %}
                                                            {% endfor %}
                                                        </ul>

                                                    </div>
                                                </li>
                                            </ul>
                                        {% endif %}
                                    {% endfor %}
                                </div>

                                <div id="search_derived_set" role="tabpanel" class="tab-pane search-set">

                                    <ul class="list-group" role="tablist" aria-multiselectable="true">
                                        {% for attr_setK, attr_setV in set_attributes.derived_set.items|check_for_order:"derived" %}

                                            {% if 'attributes' in attr_setV %}

                                                <li class="list-group-item">
                                                    <div id="{{ attr_setV.name }}_heading"
                                                         class="list-group-item__heading">
                                                        <a role="button" data-toggle="collapse"
                                                           href="#{{ attr_setV.name }}" aria-expanded="false"
                                                           aria-controls="{{ attr_setV.name }}" class="collapsed">
                                                            <i class="fa fa-solid fa-caret-right"></i> <i
                                                                class="fa fa-solid fa-caret-down"></i>{{ attr_setV.display_name }}
                                                        </a>
                                                    </div>

                                                    <div id="{{ attr_setV.name }}"
                                                         class="collapse list-group-item__body">

                                                        <ul class="list-group" role="tablist"
                                                            aria-multiselectable="true">
                                                            {% for attr in attr_setV.attributes|order_quant:attr_setK %}
                                                                <li class="list-group-item">
                                                                    <div id="{{ attr.name }}_heading"
                                                                         class="list-group-item__heading">
                                                                        <a role="button" data-toggle="collapse"
                                                                           href="#{{ attr.name }}" aria-expanded="false"
                                                                           aria-controls="{{ attr.name }}">
                                                                            <i class="fa fa-solid fa-caret-right"></i>
                                                                            <i class="fa fa-solid fa-caret-down"></i>
                                                                            <span class="attDisp">{{ attr.display_name }}
                                                                                {% if attr.units %}({{ attr.units }}
                                                                                    ){% endif %}</span> <span
                                                                                class="notDisp noCase"> (0 cases)</span>
                                                                        </a>

                                                                        <span class="controls">
                                                                          <i class="fa-solid fa-cog" title="Sort results"></i>
                                                                          <i class="fa-solid fa-search" title="Filter displayed values"></i>
                                                                        </span>

                                                                    </div>

                                                                    <div id="{{ attr.name }}"
                                                                         data-filter-attr-id="{{ attr.id }}"
                                                                         data-filter-display-attr="{{ attr.display_name }}"
                                                                         data-plotnm="{{ attr.name|plotnm }}"
                                                                         class="collapse list-group-item__body collapse"
                                                                            {% if attr.min_max %}
                                                                         data-min="{{ attr.min_max.min|floor }}"
                                                                         data-max="{{ attr.min_max.max|ceiling }}"
                                                                         data-curmin="{{ attr.min_max.min }}"
                                                                         data-curmax="{{ attr.min_max.max }}"
                                                                         data-curminrng="{{ attr.min_max.min|floor }}"
                                                                         data-curmaxrng="{{ attr.min_max.max|ceiling }}"
                                                                            {% endif %}>
                                                                        <input class="text-filter value-search notDisp"
                                                                               type="text" placeholder="Search..."
                                                                               onkeyup="updateFilters( '{{ attr.name }}',{},false, true)">
                                                                        <div class="sorter cntr notDisp">
                                                                            <span>Sort by: <input type="radio"
                                                                                                  class="sort_val"
                                                                                                  name="{{ attr.name }}"
                                                                                                  value="alpha" checked
                                                                                                  onclick="resort('{{ attr.name }}')">Alpha<input
                                                                                    type="radio" class="sort_val"
                                                                                    name="{{ attr.name }}" value="num"
                                                                                    onclick="resort('{{ attr.name }}')">Num</span>
                                                                        </div>
                                                                        {% if attr.values|length > 5 %}
                                                                            {% with attr.values|length|add:"-5" as more %}
                                                                                <p class="more-checks"
                                                                                   style="display: block;"><a
                                                                                        class="show-more">show {{ more }}
                                                                                    more</a><span class="checks"><a
                                                                                        class="check-all">Check All</a> / <a
                                                                                        class="uncheck-all">Uncheck All</a></span>
                                                                                </p>
                                                                                <p class="less-checks"
                                                                                   style="display: none;"><a
                                                                                        class="show-less">show
                                                                                    less</a><span class="checks"><a
                                                                                        class="check-all">Check All</a> / <a
                                                                                        class="uncheck-all">Uncheck All</a></span>
                                                                                </p>
                                                                            {% endwith %}
                                                                        {% else %}
                                                                            <p class="check-uncheck"><span
                                                                                    class="checks2"><a
                                                                                    class="check-all">Check All</a> / <a
                                                                                    class="uncheck-all">Uncheck All</a></span>
                                                                            </p>
                                                                        {% endif %}
                                                                        <ul id="{{ attr.name }}_list"
                                                                            class="search-checkbox-list"
                                                                            style="list-style: none;">
                                                                            {% for val in attr.values|order_seg:attr_setK %}
                                                                                {% with val.display_value|get_display_val:val.value as display_value %}
                                                                                    <li class="checkbox{% if attr.values|length > 1 and forloop.counter >= 6 %} extra-values notDisp{% endif %} {% if val.count == 0 %} zeroed {% endif %}">
                                                                                        <label class="tooltip_ex{% if display_value == 'None' %} checkbox-none{% endif %}">
                                                                                            <input type="checkbox"
                                                                                                    {% if display_value == 'None' %}
                                                                                                   disabled="true"
                                                                                                   class="checkbox-disabled "{% endif %}
                                                                                                   value="{{ val.value }}"
                                                                                                   data-filter-attr-id="{{ attr.id }}"
                                                                                                   data-filter-display-attr="{{ attr.display_name }}"
                                                                                                   data-filter-display-val="{{ display_value }}">
                                                                                            <span class="value">{{ display_value }}</span>
                                                                                            <span class="float-right plot_count count plotit">{{ val.count }}</span>
                                                                                            <span class="float-right case_count count ">{{ val.count }}</span>
                                                                                        </label>
                                                                                    </li>
                                                                                {% endwith %}
                                                                            {% endfor %}
                                                                        </ul>
                                                                    </div>
                                                                </li>
                                                            {% endfor %}
                                                        </ul>
                                                    </div>
                                                </li>
                                            {% endif %}
                                        {% endfor %}
                                    </ul>
                                </div>

                                <div id="search_related_set" role="tabpanel" class="tab-pane search-set">
                                    <ul class="list-group" role="tablist" aria-multiselectable="true">
                                        <li class="list-group-item">
                                            <div id="tcga_clinical_heading" class="list-group-item__heading">
                                                <a role="button" data-toggle="collapse" href="#tcga_clinical"
                                                   aria-expanded="false" aria-controls="tcga_clinical"
                                                   class="collapsed disabled">
                                                    <i class="fa fa-solid fa-caret-right"></i> <i
                                                        class="fa fa-solid fa-caret-down"></i>TCGA
                                                </a>
                                            </div>
                                            <div id="tcga_clinical" class="collapse list-group-item__body"
                                                 aria-expanded="false">

                                                {% for attr in set_attributes.related_set.All.attributes %}
                                                    <ul class="list-group" role="tablist" aria-multiselectable="true">
                                                        <li class="list-group-item">
                                                            <div id="{{ attr.name }}_heading"
                                                                 class="list-group-item__heading">
                                                                <a role="button" data-toggle="collapse"
                                                                   href="#{{ attr.name }}" aria-expanded="false"
                                                                   aria-controls="{{ attr.name }}">
                                                                    <i class="fa fa-solid fa-caret-right" disabled></i>
                                                                    <i class="fa fa-solid fa-caret-down" disabled></i>
                                                                    <span class="attDisp">{{ attr.display_name }}
                                                                        {% if attr.units %}({{ attr.units }}
                                                                            ){% endif %}</span> <span
                                                                        class="notDisp noCase"> (0 TCGA cases)</span>
                                                                </a>
                                                                <span class="controls">
                                                         <i class="fa-solid fa-cog" title="Sort results"></i>
                                                         <i class="fa-solid fa-search"
                                                            title="Filter displayed values"></i>
                                                     </span>
                                                            </div>
                                                            <div id="{{ attr.name }}"
                                                                 data-filter-attr-id="{{ attr.id }}"
                                                                 class="collapse list-group-item__body collapse"
                                                                 aria-expanded="false"
                                                                    {% if attr.min_max %}
                                                                 data-min="{{ attr.min_max.min|floor }}"
                                                                 data-filter-display-attr="{{ attr.display_name }}"
                                                                 data-max="{{ attr.min_max.max|ceiling }}"
                                                                 data-curmin="{{ attr.min_max.min }}"
                                                                 data-curmax="{{ attr.min_max.max }}"
                                                                 data-curminrng="{{ attr.min_max.min|floor }}"
                                                                 data-curmaxrng="{{ attr.min_max.max|ceiling }}"
                                                                    {% endif %}>
                                                                {% if attr.name != 'bmi' %}
                                                                    <input class="text-filter value-search notDisp"
                                                                           type="text" placeholder="Search..."
                                                                           onkeyup="updateFilters( '{{ attr.name }}',{},false, true)">
                                                                    <div class="sorter cntr notDisp">
                                                                        Sort by: <input type="radio" class="sort_val"
                                                                                        name="{{ attr.name }}"
                                                                                        value="alpha" checked
                                                                                        onclick="resort('{{ attr.name }}')">Alpha
                                                                        <input type="radio" class="sort_val"
                                                                               name="{{ attr.name }}" value="num"
                                                                               onclick="resort('{{ attr.name }}')">Num
                                                                    </div>

                                                                {% endif %}

                                                                {% if attr.values|length > 5 %}
                                                                    {% with attr.values|length|add:"-5" as more %}

                                                                        <p class="more-checks" style="display: block;">
                                                                            <a class="show-more">show {{ more }}
                                                                                more</a><span class="checks"><a
                                                                                class="check-all">Check All</a> / <a
                                                                                class="uncheck-all">Uncheck All</a></span>
                                                                        </p>
                                                                        <p class="less-checks" style="display: none;"><a
                                                                                class="show-less">show less</a><span
                                                                                class="checks"><a class="check-all">Check All</a> / <a
                                                                                class="uncheck-all">Uncheck All</a></span>
                                                                        </p>
                                                                    {% endwith %}
                                                                {% else %}

                                                                    <p class="check-uncheck" style="display: block;">
                                                                        <span class="checks2"> <a class="check-all">Check All</a> / <a
                                                                                class="uncheck-all">Uncheck All</a></span>
                                                                    </p>

                                                                {% endif %}


                                                                <ul id="{{ attr.name }}_list"
                                                                    class="search-checkbox-list"
                                                                    style="list-style: none;">
                                                                    {% for val in attr.values|check_for_order:attr.name %}
                                                                        <li class="checkbox{% if attr.values|length > 1 and forloop.counter >= 6 %} extra-values notDisp{% endif %}  {% if val.count == 0 %} zeroed {% endif %}">
                                                                            <label>
                                                                                <input type="checkbox"
                                                                                       data-filter-attr-id="{{ attr.id }}"
                                                                                       data-filter-display-val="{{ val.value }}"
                                                                                       data-filter-display-attr="{{ attr.display_name }}"
                                                                                       value="{{ val.value }}">
                                                                                <span class="value">{% if val.display_value %}
                                                                                    {{ val.display_value }}{% else %}
                                                                                    {{ val.value|format_val }}{% endif %}</span>
                                                                                <span class="float-right plot_count count plotit">{{ val.count }}</span><span
                                                                                    class="float-right case_count count">{{ val.count }}</span>
                                                                            </label>
                                                                        </li>
                                                                    {% endfor %}
                                                                </ul>

                                                            </div>
                                                        </li>
                                                    </ul>
                                                {% endfor %}

                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div id="rh_panel" class="col-lg-9 col-md-9 main_cols">
                <div id="show_lh" class="filter-panel panel data-tab-content-panel rh hidden">
                    <a data-toggle="collapse" aria-label="showit" onclick="showPanel()"><i
                            class="show fa fa-angle-double-right"></i></a>
                </div>
                {% if is_cohort %}
                    <div class="tabpanel data-tab-content-panel">
                        <div class="panel panel-default">
                            <div class="panel-heading clearfix"><h4 class="panel-title">Cohort Description</h4></div>
                            <div class="panel-body">
                                <p>
                                    {{ cohort.description }}
                                </p>
                            </div>
                        </div>
                    </div>
                {% endif %}
                <div class="tabpanel data-tab-content-panel">
                    <div class="panel panel-default">
                        <div class="panel-heading clearfix"><h4 class="panel-title">Filter Definition</h4>
                            {% if not is_cohort %}
                                <a class="pull-right clear-filters btn btn-primary" role="button" id="5-data-clear-filters">Reset</a>
                            {% else %}
                                <a class="pull-right btn btn-primary" role="button" href={% url 'explore_data' %}>Return
                                    to Data Explorer</a>
                            {% endif %}
                        </div>
                        <div class="panel-body">
                            <input id="filt_txt" type="hidden" value="">
                            <div id="search_def"><span class="placeholder">&nbsp;</span></div>
                            <div id="search_def_stats" class="notDisp">No Text</div>
                            <div id="search_def_warn" style="display:none">Note: TCGA.* filters only apply to TCGA
                                collections
                            </div>
                            <div id="search_def_access" class="notDisp" style="color:red">This cohort includes collections with limited access. The DICOM files of these collections are not publicly available
                            </div>

                            <div class="space-top-10 space-top-10">
                                <button
                                        class="btn btn-special get-filter-uri space-bottom-5"
                                        disabled
                                        role="button"
                                        title="Select a filter to enable this feature.">Display Filter URL</button>
                                <button
                                        class="btn btn-special hide-filter-uri space-bottom-5"
                                        role="button" style="display: none;" title="Hide the filter query URL.">Hide Filter URL</button>
                                <button role="button" class="btn btn-primary copy-this copy-url space-bottom-5"
                                        disabled title="Copy Filter URL to clipboard" style="display:none;">
                                    <i class="fa-solid fa-copy" aria-hidden="true"></i>
                                </button>
                                <pre class="filter-url code is-hidden" style="display:none;"></pre>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="vert">
                    <div class="filter-panel panel" role="tabpanel">
                        <div class="tabpanel panel-default" role="tabpanel">
                            <div class="panel-heading clearfix">
                                <h4 class="panel-title">Search Results
                                    <div class="tooltip_filter_info" style="float:right"><i
                                            class="fa-solid fa-info-circle"></i></div>
                                </h4>

                                <div style="display:none">
                                    <label>Chart Type:</label>
                                    <select id="plot_type" onchange="updatePlots(this)">
                                        <option selected value="pie">Pie</option>
                                        <option value="bar">Bar</option>
                                    </select>
                                    <label><input id="plot_label" type="checkbox" onchange="updatePlots(this)"> Add
                                        labels?</label>
                                </div>
                            </div>

                            <ul class="nav nav-tabs nav-tabs-filters" role="tablist">
                                <li id="results_orig" role="presentation" class="filter-tab active"><a
                                        href="#results_orig_set" role="tab" data-toggle="tab" title="orig"
                                        aria-expanded="true">Original</a></li>
                                {% if set_attributes.derived_set is None %}
                                    <li id="results_derived" role="presentation" class="filter-tab disabled"><a
                                            href="#results_derived_set" role="tab" data-toggle="tab" title="derived"
                                            aria-expanded="false">Derived</a></li>
                                {% else %}
                                    <li id="results_derived" role="presentation" class="filter-tab"><a
                                            href="#results_derived_set" role="tab" data-toggle="tab" title="derived"
                                            aria-expanded="false">Derived</a></li>
                                {% endif %}
                                <li id="results_related" role="presentation" class="filter-tab"><a
                                        href="#results_related_set" role="tab" data-toggle="tab" title="related"
                                        aria-expanded="false">Related</a></li>
                            </ul>
                            <div class="tab-content">
                                <div id="results_orig_set" role="tabpanel" class="tab-pane active panel">
                                    <div class="panel-body original-graphs graph-set">
                                        {% for attr in set_attributes.origin_set.All.attributes %}
                                            {% if attr.name != 'access' and attr.name != 'collection_id' and attr.name != 'analysis_results_id' %}
                                                <div id="{{ attr.name }}_chart" class="bar-chart">
                                                    <svg width="240" height="200"></svg>
                                                </div>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                    <div class="graph-explain"><img src="{% static 'img/results_glyp.png' %}"
                                                                    width="20%" height="20%"> <a
                                            class="explainer">Why</a> do the pie charts sometimes show attribute values
                                        that were not selected?
                                    </div>
                                </div>

                                <div id="results_derived_set" role="tabpanel" class="tab-pane panel">
                                    <div class="panel-body bar-charts-div-derived derived-graphs">
                                        {% for attr_setK, attr_setV in set_attributes.derived_set.items|check_for_order:"derived" %}
                                            {% if 'attributes' in attr_setV %}

                                                <div class="tab-pane">
                                                <div style="text-align:center" class="panel-heading clearfix"><h3
                                                        style="text-align:center"
                                                        class="panel-title">{{ attr_setV.display_name }}</h3></div>

                                                {% if forloop.counter > 1 %}
                                                    <div class="more-graphs" style="display: block;width:100%">
                                                        <button class="btn btn-link" role="button"
                                                                onclick="showGraphs(this)">Show
                                                        </button>
                                                    </div>
                                                    <div class="less-graphs" style="display: none; width:100%">
                                                        <button class="btn btn-link" role="button"
                                                                onclick="hideGraphs(this)">Hide
                                                        </button>
                                                    </div>

                                                    <div class="panel-body  graph-set" style="display:none">
                                                {% else %}
                                                    <div class="panel-body  graph-set">
                                                {% endif %}

                                            {% for attr in attr_setV.attributes|order_quant:attr_setK %}
                                                <div id="{{ attr.name }}_chart" class="bar-chart">
                                                    <svg width="240" height="200"></svg>
                                                </div>

                                            {% endfor %}
                                            </div>
                                            </div>
                                            {% endif %}
                                        {% endfor %}
                                        </div>
                                        <div class="graph-explain"><img src="{% static 'img/results_glyp.png' %}"
                                                                        width="20%" height="20%"> <a class="explainer">Why</a>
                                            do the pie charts sometimes show attribute values that were not selected?
                                        </div>

                                    </div>
                                    <div id="results_related_set" role="tabpanel" class="tab-pane panel">
                                        <div class="panel-body related-graphs graph-set">

                                            {% for attr in set_attributes.related_set.All.attributes %}

                                                {% if forloop.counter <= 3 %}
                                                    <div id="{{ attr.name }}_chart" class="bar-chart ">
                                                        <svg width="240" height="200"></svg>
                                                    </div>
                                                {% else %}
                                                    <div id="{{ attr.name }}_chart"
                                                         class="bar-chart chart-overflow hide-chart">
                                                        <svg width="240" height="200"></svg>
                                                    </div>
                                                {% endif %}

                                            {% endfor %}

                                        </div>
                                        <div class="more-graphs" style="display: block;width:100%">
                                            <button class="btn btn-link" role="button"
                                                    onclick="toggleGraphOverFlow('related-graphs',true)">Show More
                                            </button>
                                        </div>
                                        <div class="less-graphs" style="display: none; width:100%">
                                            <button class="btn btn-link" role="button"
                                                    onclick="toggleGraphOverFlow('related-graphs',false)">Show Less
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="tabpanel data-tab-content-panel table-panel">
                            <div class="panel panel-default">
                                <div class="panel-heading clearfix"><h4 class="panel-title">Collections</h4></div>
                                <div id="projects_panel" class="panel-body">

                                    <table id="proj_table" class="table table-striped">
                                        <thead id="projects_table_head">
                                        <tr>
                                            <th class="ckbx text_data">
                                                <i class="fa-solid fa-plus-circle fa-lg"
                                                   onclick="(updateMultipleRows($($(this).parentsUntil('table')[2]).parent(),true,'projects'))"
                                                   style="font-family :'Font Awesome 6 Free' !important"></i>
                                                <i class="fa-solid fa-circle-minus fa-lg"
                                                   onclick="(updateMultipleRows($($(this).parentsUntil('table')[2]).parent(),false,'projects'))"
                                                   style="font-family :'Font Awesome 6 Free' !important"></i>
                                            </th>
                                            <th class='text_data'>Collection Name</th>
                                            <th class='numeric_data'>Total # of Cases</th>
                                            <th class='numeric_data'># of Cases(this cohort)</th>
                                        </tr>
                                        </thead>

                                    </table>
                                </div>
                            </div>
                        </div>

                        <div class="tabpanel data-tab-content-panel table-panel">
                            <div class="panel panel-default">
                                <div class="panel-heading clearfix"><h4 class="panel-title">Selected Cases</h4></div>
                                <div id="cases_panel" class="panel-body">

                                    <table id="cases_tab" class="table table-striped">
                                        <thead id="cases_table_head">
                                        <tr>
                                            <th class="ckbx text_data notVis">
                                                <i class="fa-solid fa-plus-circle fa-lg"
                                                   onclick="(updateMultipleRows($($(this).parentsUntil('table')[2]).parent(),true,'cases'))"
                                                   style="font-family :'Font Awesome 6 Free' !important"></i>
                                                <i class="fa-solid fa-circle-minus fa-lg"
                                                   onclick="(updateMultipleRows($($(this).parentsUntil('table')[2]).parent(),false,'cases'))"
                                                   style="font-family :'Font Awesome 6 Free' !important"></i>
                                            </th>
                                            <th class='text_data'>Collection Name</th>
                                            <th class='text_data'>Case ID <i class="fas fa-info-circle case-info"></i></th>
                                            <th class='numeric_data'>Total # of Studies</th>

                                            <th class='numeric_data'>Total # of Series</th>

                                        </tr>
                                        </thead>

                                    </table>
                                </div>
                            </div>
                        </div>


                        <div class="tabpanel data-tab-content-panel table-panel">
                            <div class="panel panel-default">
                                <div class="panel-heading clearfix"><h4 class="panel-title">Selected Studies</h4></div>
                                <div class="panel-body">
                                    <table id="studies_tab" class="table table-striped studies-table">
                                        <thead id="studies_table_head">
                                        <tr>
                                            <th class="ckbx text_data notVis">
                                                <i class="fa-solid fa-plus-circle fa-lg"
                                                   onclick="(updateMultipleRows($($(this).parentsUntil('table')[2]).parent(),true,'studies'))"></i>
                                                <i class="fa-solid fa-circle-minus fa-lg"
                                                   onclick="(updateMultipleRows($($(this).parentsUntil('table')[2]).parent(),false,'studies'))"></i>
                                            </th>
                                            <th class='col1 text_data case-id has_aux' data-auxid='3'>Case ID <i class="fas fa-info-circle case-info"></i></th>
                                            <th class='col2 text_data study-id study-id-col'>Study Instance UID</th>
                                            <th class='col1 text_data study-date'>Study Date</th>
                                            <th class='col1 text_data study-description'>Study Description</th>
                                            <th class='col1 numrows numeric_data'># of Series</th>
                                            <th class="ohif text_data open-viewer">View</th>
                                        </tr>
                                        </thead>


                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="tabpanel data-tab-content-panel table-panel">
                            <div class="panel panel-default">
                                <div class="panel-heading clearfix"><h4 class="panel-title">Selected Series</h4></div>
                                <div class="panel-body">

                                    <table id="series_tab" class="table table-striped series-table">
                                        <thead id="series_table_head">
                                        <tr>
                                            <th class="study-id">Study Instance UID</th>
                                            <th class="series-id ">Series Instance UID</th>
                                            <th class="series-number numeric_data">Series Number</th>
                                            <th class="modality">Modality</th>
                                            <th class="body-part-examined">Body Part Examined</th>
                                            <th class="series-description">Series Description</th>
                                            <th class="open-viewer text_data">View</th>
                                        </tr>
                                        </thead>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
