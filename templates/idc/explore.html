{% extends 'base.html' %}
{% load custom_tags %}
{% load staticfiles %}

{% comment %}

   Copyright 2015, Institute for Systems Biology

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.

{% endcomment %}

{% block header %}


    <!-- <script type="text/javascript" src="{% static 'js/libs/require.js' %}"></script> -->
    <!-- <script type="text/javascript" src="{% static 'js/image_search.js' %}"></script> -->
    <script type="text/javascript" src="{% static 'js/libs/plotly-latest.min.js' %}"></script>

    <script data-main="{% static 'js/image_search.js' %}" src="{% static 'js/libs/require.js' %}"></script>


    <link type="text/css" rel="stylesheet" href="{% static 'css/search.css' %}">
    <!-- <link type="text/css" rel="stylesheet" href="{% static 'css/vendor.css' %}">
    <link type="text/css" rel="stylesheet" href="{% static 'css/bootstrap.css' %}"> -->




{% endblock %}


<div id="secondary-nav" class="navbar-fixed-top">

</div>
{% block link_page_name %}help{% endblock %}
{% block page_name %}cohort-details{% endblock %}

{% block page_header %}
    <div class="page-heading">
        <div class="container" style="display: block;">
                <ol class="breadcrumb">
                    <li><a href="/dashboard/">Your Dashboard</a></li>
                    <li><a href="/explore/">Explore</a></li>
                </ol>

                <h1 class="page-header pull-left" role="heading" aria-level="1">Explore Image Data</h1>
                <button class="btn btn-primary pull-right" data-toggle="modal" data-target="#create-cohort-modal" title="Please select at least one filter." disabled="disabled">Save As New Cohort</button>
        </div>
    </div>
{% endblock %}


{% block content %}

<div class="container" style="display:block">
    <div class ="row">
        <div class="tab-content data-tab-content">
            <div class="tab-pane data-tab active" role="tabpanel">
                 <div class="col-lg-3">
                     <div class="tabpanel data-tab-content-panel">
                         <div class="panel panel-default">
                         <div class="panel-heading clearfix"><h4 class="panel-title">Search Scope</h4></div>
                         <div class="panel-body">
                             <select id="project_scope" onchange="updateSearchScope(this)">
                             <option value="All" >All data</option>
                          </select>
                         </div>
                         </div>
                     </div>

                      <div class="filter-panel" role="tabpanel">
                         <div class="tabpanel panel-default" role="tabpanel">
                             <div class="panel-heading clearfix"><h4 class="panel-title">Configuration</h4></div>
                              <ul class="nav nav-tabs nav-tabs-filters" role="tablist">
                                  <li id = "search_orig" role="presentation" class="filter-tab active"><a href="#search_orig_set" role="tab" data-toggle="tab" title="orig" aria-expanded="true">Original</a></li>
                                  <li id = "search_derived" role="presentation" class="filter-tab"><a href="#search_derived_set" role="tab" data-toggle="tab" title="derived" aria-expanded="false"">Derived</a></li>
                                  <li id = "search_related" role="presentation" class="filter-tab"><a href="#search_related_set" role="tab" data-toggle="tab" title="related" aria-expanded="false">Related</a></li>
                             </ul>
                        <div class="tab-content">
                            <div id = "search_orig_set" role="tabpanel" class="tab-pane active">
                           <!-- TODO: We need to make this request the list of attributes from the server -->
                           <!-- TODO: example here: -->
                            {% for attr in set_attributes.origin_set.attributes %}
                             <ul class="list-group" role="tablist" aria-multiselectable="true">
                                 <li class="list-group-item">
                                   <div id="{{ attr.name }}_heading" class="list-group-item__heading">
                                       <a role="button" data-toggle="collapse"  href="#{{ attr.name }}" aria-expanded="false" aria-controls="{{ attr.name }}">
                                           <i class="fa fa-caret-right"></i> <i class="fa fa-caret-down"></i> {{ attr.display_name }}</a>
                                  </div>

                                    <div id="{{ attr.name }}" class="collapse list-group-item__body collapse in">
                                        <ul id="{{ attr.name }}_list" class="search-checkbox-list" style="list-style: none;">
                                           {% for val in attr.values %}
                                            <li class="checkbox{% if attr.values|length > 1 and forloop.counter >= 6 %} extra-values{% endif %}">
                                                   <label>
                                                       <input type="checkbox" checked value="{{ val.value }}"
                                                             onclick="updateFilterSelection('{{ attr.name }}_list', '{{ attr.name }}_set','{{ attr.display_name }}','{{ attr.name }}',false,false)">
                                                        {% if val.display_value %}{{ val.display_value }}{% else %}{{ val.value|format_val }}{% endif %} <span class="float-right case_count count">{{ val.count }}</span>
                                                    </label>
                                                </li>
                                            {% endfor %}
                                        </ul>
                                       <p style="display: block;" >
                                           {% if attr.values|length > 5 %}
                                                <p class="more-checks" style="display: block;" ><a class="show-more">show more</a><span class="checks"><a class="check-all">Check All</a> / <a class="uncheck-all">Uncheck All</a></span></p>
                                                <p class="less-checks" style="display: none;" > <a class="show-less">show less</a><span class="checks"><a class="check-all">Check All</a> / <a class="uncheck-all">Uncheck All</a></span></p>

                                           {% endif %}

                                        </p>
                                   </div>
                                </li>
                             </ul>
                            {%  endfor %}
                                <!--
                             <ul class="list-group" role="tablist" aria-multiselectable="true">
                                 <li class="list-group-item">
                                     <div id="modality_heading" class="list-group-item__heading">
                                     <a role="button" data-toggle="collapse"  href="#modality" aria-expanded="false" aria-controls="modality">
                                    <i class="fa fa-caret-right"></i> <i class="fa fa-caret-down"></i>Modality</a>
                                    </div>
                                     <div id="modality" class="collapse list-group-item__body">

                                         <p class="more-checks" style="display: block;" ><a class="show-more">show more</a><span class="checks"><a class="check-all">Check All</a> / <a class="uncheck-all">Uncheck All</a></span></p>
                                         <p class="less-checks" style="display: none;" > <a class="show-less">show less</a><span class="checks"><a class="check-all">Check All</a> / <a class="uncheck-all">Uncheck All</a></span></p>
                                        <ul style="list-style: none;">
                                        <li class="checkbox">&emsp;<input type="checkbox" value="CT" >Computed Tomography(CT)</li>
                                       <li class="checkbox">&emsp;<input type="checkbox" value="CTPT">Computed Tomography/Position Emisson Tomography(CTPT)</li>
                                       <li class="checkbox">&emsp;<input type="checkbox" value="CR" >Computed Radiology(CR)</li>
                                       <li class="checkbox">&emsp;<input type="checkbox" value="MR" >Magnetic Resonance(MR)</li>
                                         <li class="checkbox">&emsp;<input type="checkbox" value="MG" >Mamography(MG)</li>
                                       <li class="checkbox extra-values">&emsp;<input type="checkbox" value="NM" >Nuclear Medicine(NM)</li>
                                       <li class="checkbox extra-values">&emsp;<input type="checkbox" value="RTPLAN" >Radiotherapy Plan(RTPLAN)</li>
                                       <li class="checkbox extra-values">&emsp;<input type="checkbox" value="RTSTRUCT" >Radiotheraoy Structure Set(RTSTRUCT)</li>
                                       </ul>

                                   </div>
                                 </li>

                                 <li class="list-group-item">
                                     <div id="body_heading" class="list-group-item__heading">
                                      <a role="button" data-toggle="collapse"  href="#body_part" aria-expanded="false" aria-controls="body_part">
                                       <i class="fa fa-caret-right"></i> <i class="fa fa-caret-down"></i>Body Part Examined</a>
                                     </div>
                                     <div id="body_part" class="collapse list-group-item__body">
                                         <p class="more-checks" style="display: block;" ><a class="show-more">show more</a><span class="checks"><a class="check-all">Check All</a> / <a class="uncheck-all">Uncheck All</a></span></p>
                                         <p class="less-checks" style="display: none;" > <a class="show-less">show less</a><span class="checks"><a class="check-all">Check All</a> / <a class="uncheck-all">Uncheck All</a></span></p>
                                        <ul style="list-style: none;">
                                           <li class="checkbox">&emsp;<input type="checkbox" value="BLADDER">Bladder</li>
                                          <li class="checkbox">&emsp;<input type="checkbox" value="BRAIN">Brain </li>
                                          <li class="checkbox">&emsp;<input type="checkbox" value="CHEST" >Chest</li>
                                         <li class="checkbox">&emsp;<input type="checkbox"  value="COLON" >Colon</li>
                                         <li class="checkbox">&emsp;<input type="checkbox"  value="HEADNECK" >Head/Neck</li>
                                        <li class="checkbox extra-values">&emsp;<input type="checkbox"  value="KIDNEY" >Kidney</li>
                                       <li class="checkbox extra-values">&emsp;<input type="checkbox"  value="PROSTATE" >Prostate</li>
                                         <li class="checkbox extra-values">&emsp;<input type="checkbox"  value="STOMACH" >Stomach</li>
                                       <li class="checkbox extra-values">&emsp;<input type="checkbox"  value="THYROID" >Thyroid</li>
                                       <li class="checkbox extra-values">&emsp;<input type="checkbox" value="None" >Not Available/Other</li>
                                      </ul>
                                    </div>
                                 </li>
                         </ul> -->
                   </div>
                            <div id = "search_derived_set" role="tabpanel" class="tab-pane">
                                <ul class="list-group" role="tablist", aria-multiselectable="true">
                                    <li class="list-group-item">
                                         <div id="segmentation_heading" class="list-group-item__heading">
                                         <a role="button" data-toggle="collapse"  href="#segmentation" aria-expanded="false" aria-controls="segmentation" class="">
                                         <i class="fa fa-caret-right"></i> <i class="fa fa-caret-down"></i>Segmentation</a>
                                          </div>
                                         <div id="segmentation" class="collapse list-group-item__body">
                                      <ul style="list-style: none;">
                                         <li>&emsp;<input type="checkbox" checked value="yes">&emsp;Segmentation Available</li>
                                        <li>&emsp;<input type="checkbox" checked value="no">&emsp;Segmentation Not Available</li>
                                      </ul>
                                  </div>
                                    </li>
                                </ul>
                        </div>
                            <div id = "search_related_set" role="tabpanel" class="tab-pane">
                                   <ul class="list-group" role="tablist" aria-multiselectable="true">
        {#                            <!-- TODO: Same as above here but for relateds-->#}


                                   <li class="list-group-item">
                                       <div id="disease_heading" class="list-group-item__heading">
                                           <a role="button" data-toggle="collapse"  href="#disease" aria-expanded="false" aria-controls="disease">
                                               <i class="fa fa-caret-right"></i><i class="fa fa-caret-down"></i> Disease Code</a>
                                      </div>

                                       <div id="disease" class="collapse list-group-item__body">
                                           <p class="more-checks" style="display: block;" ><a class="show-more">show more</a><span class="checks"><a class="check-all">Check All</a> / <a class="uncheck-all">Uncheck All</a></span></p>
                                           <p class="less-checks" style="display: none;" > <a class="show-less">show less</a><span class="checks"><a class="check-all">Check All</a> / <a class="uncheck-all">Uncheck All</a></span></p>
                                        <ul id="disease_list" style="list-style: none;">
                                             <!-- <li class="checkbox"> <input type="checkbox" value="BLCA">BLCA</li> -->
                                        </ul>
                                      </div>
                                   </li>

                                    <li class="list-group-item">
                                      <div id="vital_heading" class="list-group-item__heading">
                                      <a role="button" data-toggle="collapse"  href="#vital_status" aria-expanded="false" aria-controls="vital_status">
                                          <i class="fa fa-caret-right"></i><i class="fa fa-caret-down"></i> Vital Status</a>
                                     </div>

                            <div id="vital_status" class="collapse list-group-item__body">
                                 <p class="more-checks" style="display: block;" ><a class="show-more">show more</a><span class="checks"><a class="check-all">Check All</a> / <a class="uncheck-all">Uncheck All</a></span></p>
                                   <p class="less-checks" style="display: none;" > <a class="show-less">show less</a><span class="checks"><a class="check-all">Check All</a> / <a class="uncheck-all">Uncheck All</a></span></p>
                               <ul id="vital_list" style="list-style: none;">
                                  <li class="checkbox">&emsp;<input type="checkbox"  value="Alive" >Alive</li>
                                 <li class="checkbox">&emsp;<input type="checkbox" value="Dead" >Dead</li>
                                 <li class="checkbox">&emsp;<input type="checkbox" value="None">NA</li>
                                </ul>
                             </div>
                            </li>

                            <li class="list-group-item">
                              <div id="gender_heading" class="list-group-item__heading">
                                   <a role="button" data-toggle="collapse"  href="#gender" aria-expanded="false" aria-controls="vital">
                                  <i class="fa fa-caret-right"></i><i class="fa fa-caret-down"></i>Gender</a>
                              </div>

                             <div id="gender" class="collapse list-group-item__body">
                                  <p class="more-checks" style="display: block;" ><a class="show-more">show more</a><span class="checks"><a class="check-all">Check All</a> / <a class="uncheck-all">Uncheck All</a></span></p>
                                   <p class="less-checks" style="display: none;" > <a class="show-less">show less</a><span class="checks"><a class="check-all">Check All</a> / <a class="uncheck-all">Uncheck All</a></span></p>
                              <ul id="gender_list" style="list-style: none;">
                                    <li class="checkbox">&emsp;<input type="checkbox" value="MALE" >Male</li>
                                  <li class="checkbox">&emsp;<input type="checkbox" value="FEMALE" >Female</li>
                                 <li class="checkbox">&emsp;<input type="checkbox" value="None" >NA</li>
                              </ul>
                              </div>
                           </li>

                           <li class="list-group-item">
                            <div id="age_heading" class="list-group-item__heading">
                             <a role="button" data-toggle="collapse"  href="#age" aria-expanded="false" aria-controls="age">
                                <i class="fa fa-caret-right"></i><i class="fa fa-caret-down"></i>Age</a>
                           </div>

                          <div id="age" class="collapse list-group-item__body">
                            <div id="age_slide"></div>
                             <input id="inp_age_slide" type="text" value="0-120">
                              <button onclick='resetAge()'>Reset</button>
                         </div>
                        </li>

                                   <li class="list-group-item">
                                    <div id="age_heading" class="list-group-item__heading">
                                     <a role="button" data-toggle="collapse"  href="#age" aria-expanded="false" aria-controls="age">
                                        <i class="fa fa-caret-right"></i><i class="fa fa-caret-down"></i>Age</a>
                                   </div>

                                  <div id="age" class="collapse list-group-item__body">
                                    <div id="age_slide"></div>
                                     <input id="inp_age_slide" type="text" value="0-120">
                                      <button onclick='refreshAge()'>Refresh</button>
                                 </div>
                                </li>

                                 <li class="list-group-item">
                                    <div id="race_heading" class="list-group-item__heading">
                                     <a role="button" data-toggle="collapse"  href="#race" aria-expanded="false" aria-controls="race">
                                      <i class="fa fa-caret-right"></i><i class="fa fa-caret-down"></i>Race</a>
                                  </div>

                                 <div id="race" class="collapse list-group-item__body">
                                   <p class="more-checks" style="display: block;" ><a class="show-more">show more</a><span class="checks"><a class="check-all">Check All</a> / <a class="uncheck-all">Uncheck All</a></span></p>
                                     <p class="less-checks" style="display: none;" > <a class="show-less">show less</a><span class="checks"><a class="check-all">Check All</a> / <a class="uncheck-all">Uncheck All</a></span></p>
                                    <ul id="race_list" style="list-style: none;">

                                    </ul>
                                  </div>
                                  </li>

                                  <li class="list-group-item">
                                   <div id="ethnicity_heading" class="list-group-item__heading">
                                   <a role="button" data-toggle="collapse"  href="#ethnicity" aria-expanded="false" aria-controls="ethnicity">
                                   <i class="fa fa-caret-right"></i><i class="fa fa-caret-down"></i>Ethnicity</a>
                                    </div>

                                   <div id="ethnicity" class="collapse list-group-item__body">
                                        <p class="more-checks" style="display: block;" ><a class="show-more">show more</a><span class="checks"><a class="check-all">Check All</a> / <a class="uncheck-all">Uncheck All</a></span></p>
                                     <p class="less-checks" style="display: none;" > <a class="show-less">show less</a><span class="checks"><a class="check-all">Check All</a> / <a class="uncheck-all">Uncheck All</a></span></p>
                                   <ul id="ethnicity_list" style="list-style: none;"></ul>
                                   </div>
                                  </li>
                               </ul>

                    </div>
                        </div>
                         </div>
                      </div>
                 </div>

                 <div class="col-lg-9 col-md-9">
                     <div class="tabpanel data-tab-content-panel">
                         <div class="panel panel-default">
                         <div class="panel-heading clearfix"><h4 class="panel-title">Filter Definition</h4></div>
                         <div class="panel-body">
                                <div id ="search_def"></div>
                         </div>
                         </div>
                     </div>
                     <div class="filter-panel panel" role="tabpanel">
                          <div class="tabpanel panel-default" role="tabpanel">
                              <div class="panel-heading clearfix"><h4 class="panel-title">Search Results</h4></div>
                              <ul class="nav nav-tabs nav-tabs-filters" role="tablist">
                                 <li id = "results_orig" role="presentation" class="filter-tab active"><a href="#results_orig_set" role="tab" data-toggle="tab" title="orig" aria-expanded="true">Original</a></li>
                                 <li id = "results_derived" role="presentation" class="filter-tab"><a href="#results_derived_set" role="tab" data-toggle="tab" title="derived" aria-expanded="false">Derived</a></li>
                                 <li id = "results_related" role="presentation" class="filter-tab"><a href="#results_related_set" role="tab" data-toggle="tab" title="related" aria-expanded="false">Related</a></li>
                              </ul>
                             <div class="tab-content">
                               <div id = "results_orig_set" role="tabpanel" class="tab-pane active panel">
                                    <div class="panel-body bar-charts-div">
                                      <div id="modality_chart" class="bar-chart"></div>
                                      <div id="body_part_examined_chart" class="bar-chart"></div>
                                    </div>
                               </div>
                             <div id = "results_derived_set" role="tabpanel" class="tab-pane panel">
                                 <div class="panel-body bar-charts-div"></div>
                             </div>

                             <div id = "results_related_set" role="tabpanel" class="tab-pane panel">
                                 <div class="panel-body bar-charts-div related-graphs">
                                     <div id="disease_code_chart" class="bar-chart"></div>
                                     <div id="vital_status_chart" class="bar-chart"></div>
                                     <div id="gender_chart" class="bar-chart"></div>
                                     <div id="age_chart" class="bar-chart"></div>
                                     <div id="race_chart" class="bar-chart"></div>
                                    <div id="ethnicity_chart" class="bar-chart"></div>
                                 </div>
                                 <div  class="more-graphs" style="display: block;width:100%"><button class="btn btn-link" role="button" onclick="showMoreGraphs()">Show More</button></div>
                                 <div class="less-graphs" style="display: none; width:100%"><button class="btn btn-link" role="button" onclick="showLessGraphs()">Show Less</button></div>
                             </div>
                            </div>
                          </div>
                    </div>
                    <div class="tabpanel data-tab-content-panel">
                         <div class="panel panel-default">
                         <div class="panel-heading clearfix"><h4 class="panel-title">Collections</h4></div>
                         <div class="panel-body">
                                <table >
                             <thead id="projects_table_head">
                             <tr>
                                <th>Collection Name</th><th>Total # of Patients</th><th># of Patients(this cohort)</th>
                             </tr>
                             </thead>
                             <tbody id="projects_table" class="set_height">
                             </tbody>
                          </table>
                         </div>
                         </div>
                     </div>

                      <div class="tabpanel data-tab-content-panel">
                         <div class="panel panel-default">
                             <div class="panel-heading clearfix"><h4 class="panel-title">Selected Studies</h4></div>
                             <div class="panel-body">
                                   <table >
                                  <thead id="studies_table_head">
                                 <tr>
                                     <th >Project Name </th><th >Patient Id</th><th>Study Id</th><th>Study Description</th>
                                 </tr>
                                  </thead>

                                 <tbody  id="studies_table" class="set_height">
                                  </tbody>
                              </table >
                             </div>
                         </div>
                     </div>

                     <div class="tabpanel data-tab-content-panel">
                         <div class="panel panel-default">
                             <div class="panel-heading clearfix"><h4 class="panel-title">Selected Series</h4></div>
                             <div class="panel-body">
                                    <table>
                                 <thead id="series_table_head">
                                  <tr>
                                    <th>Study Id</th><th>Series Id</th><th>Modality</th><th>Body Part Examined</th>
                                  </tr>
                                  </thead>

                                  <tbody id="series_table" class="set_height">

                                  </tbody>
                              </table>
                             </div>
                         </div>
                     </div>
                 </div>
            </div>
             </div>
        </div>
    </div>

</div>







        <!--
                <div id="bmi_heading" class="list-group-item__heading">
                    <a role="button" data-toggle="collapse"  href="#bmi" aria-expanded="false" aria-controls="bmi">
                        <i class="fa fa-caret-right"></i>BMI</a>
                </div>

                <div id="bmi" class="collapse">
                    <ul id="bmi_list" style="list-style: none;">
                         <li>&emsp;<input type="checkbox" checked value="0 to 18.5" onclick="updateFilterSelection('bmi_list', 'bmi_set','BMI','bmi',false,true)">Underweight: BMI less than 18.5</li>
                        <li>&emsp;<input type="checkbox" checked value="18.5 to 25" onclick="updateFilterSelection('bmi_list', 'bmi_set','BMI','bmi',false,true)">Normal weight: BMI greater than or equal to 18.5 and less than 25</li>
                        <li>&emsp;<input type="checkbox" checked value="25 to 30" onclick="updateFilterSelection('bmi_list', 'bmi_set','BMI','bmi',false,true)">Overweight: BMI greater than 25 and less than 30</li>
                        <li>&emsp;<input type="checkbox" checked value="30 to 100" onclick="updateFilterSelection('bmi_list', 'bmi_set','BMI','bmi',false,true)">Obese: BMI greater than 30</li>

                        <li>&emsp;<input type="checkbox" checked value="None">NA</li>
                    </ul>
                </div>
              -->


{% endblock %}

{% block js_file %}{% static 'js/explore.js' %}{% endblock %}
